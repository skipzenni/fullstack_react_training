# Lesson 11

## Setting Server adding Username to Comment

```javascript
{!authState && (
              <>
                <Link to="/login">Login</Link>
                <Link to="/registrasi">Registrasi</Link>
              </>
            )}
```

its mean if autState login hide login and register

## Actual data for setAuthState

because in api when we request to auth, data the api send to us is data user
routes/Users.js

```javascript
router.get('/auth',validateToken, (req,res) => {
    res.json(req.user)
})
```

in client side setAuthState in App.js and Login.js, we need to username, id, and status of authentication

App.js

```javascript
const [authState, setAuthState] = useState({
    username: "",
    id: 0,
    status: false,
  });

  // if we get error data means empty username, id, and adding sttatus as false [come from request api]
  setAuthState({...authState, status: false}

  // if success we can retrive response.data to authState
  setAuthState({
          username: response.data.username,
          id: response.data.id,
          status: true,
        })
  
  // we need logout button show up when status is true
  {!authState.status ? (
              <>
                <Link to="/login">Login</Link>
                <Link to="/registrasi">Registrasi</Link>
              </>
            ) :(
              <button onClick={logout}>Logout</button>
            )
            }

  // when user click on button they execute logout function, to remove localStorage and set username and id as empty, and status false
  const logout = () => {
    localStorage.removeItem('accessToken');
    setAuthState({username: "", id: 0, status: false});
  }
```

## SetAuthState in Login page using useContext from AuthContext in App.js

we already initialized AuthContext in App.js before, now we call them in Login.js

```javascript
  // to use this Login.js need to import useContext, and AuthContext
  const {setAuthState} = useContext(AuthContext);

  // before we set auth state and localStorage we need change our api response for login, go to routes/Users.js
  res.json({token: accessToken, username: username, id: user.id});

  // and fill it when response successful, when user log in successfully, logout button will appear
  localStorage.setItem("accessToken", response.data.token);
  setAuthState({username: response.data.username, id: response.data.id, status: true})
```

## Add Delete function to Post page

After setAuthState now we can use it in Post.js by calling authState use useContext and AuthContext
`const {authState} = useContext(AuthContext);`

and add button x appears when username from authState equals with username from comment
`{authState.username === comment.username && (<button onClick={() => {deleteComment(comment.id)}}>x</button>)}`

Lets make routes for deleting comments in our api, Commen

See [Leason 12](https://lesson2.com) Preview for more details
